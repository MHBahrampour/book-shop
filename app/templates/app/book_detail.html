{% extends "base.html" %}

{% block content %}

  <!-- Detail of the Book -->
  <div class="detail-container">
    
    <div class="detail-item-container">

      <img src="{{ book.cover.url }}" alt="Book Cover">

      <div>
        <h1><i class="fa-solid fa-book"></i> {{ book.title }}</h1>

        <p>
          <span class="inline-icon"><i class="fa-solid fa-marker"></i></span> 
          <b>Author:</b> <a href="{{ book.author.get_absolute_url }}">{{ book.author }}</a>
        </p>

        {% if book.genre.all.count > 1 %}
          <p>
            <span class="inline-icon"><i class="fa-solid fa-swatchbook"></i></span> 
            <b>Genres:</b> {{ book.genre.all|join:", " }}
          </p>
        {% else %}
          <p>
            <span class="inline-icon"><i class="fa-solid fa-swatchbook"></i></span> 
            <b>Genre:</b> {{ book.genre.all|join:", " }}
          </p>
        {% endif %}
      
        <p>
          <span class="inline-icon"><i class="fa-solid fa-arrow-down-1-9"></i></span> 
          <b>ISBN:</b> {{ book.isbn }}
        </p>
        <p>
          <span class="inline-icon"><i class="fa-solid fa-sack-dollar"></i></span> 
          <b>Price:</b> {{ book.price }}$
        </p>

        <form action="{% url 'add_to_shopping_cart' pk=book.id %}">
          <input type="submit" value="Add to Shopping Cart" class="add-to-cart" onclick="sayAdded()">
        </form>

        <p>
          <span class="inline-icon"><i class="fa-solid fa-paragraph"></i></span> 
          <b>Summary:</b> {{ book.summary }}
        </p>
      </div>

    </div>
  </div>

  <!-- Explore more -->
  <div class="section-wrapper">
    <p class="title">Explore more books in this genre</p>
    <div class="list-container">   
        
      {% if genre_books_list %}

        {% for book in genre_books_list %}
          <a href="{{ book.get_absolute_url }}" class="no-decoration">
            <div class="list-item-container">

              <img src="{{ book.cover.url }}" alt="book cover" class="center-img">

              <p>
                <span class="inline-icon"><i class="fa-solid fa-book"></i></span> 
                {{ book.title }}
              </p>
              <p>
                <span class="inline-icon"><i class="fa-solid fa-marker"></i></span> 
                {{ book.author }}
              </p>
        
              {% if book.is_available %}
                <p>
                  <span class="inline-icon"><i class="fa-solid fa-sack-dollar"></i></span> 
                  {{ book.price }} &mdash; <span class="available">Available in stock</span>
                </p>
              {% else %}
                <p class="not-available">Not available</p>
              {% endif %}
            
            </div>
          </a>
        {% endfor %}

      {% else %}
        <p>There are no books in the shop.</p>

      {% endif %}

    </div>
  </div>

  
  <!-- Sending a comment -->
  <div class="section-wrapper">

    <p class="title">Send a comment</p>

    <div class="form no-shadow">
      <form method="post">
        {% csrf_token %}

        {% for field in comment_form %}
          <div class="field-wrapper">

            {{ field.errors }}

            {% if field.type == radio %}

              {{ field.label_tag }}
              <div class="radio">
                {{ field }}
              </div>

            {% else %}
              {{ field.label_tag }} {{ field }}

            {% endif %}
          
          </div>
        {% endfor %}
            
        <input type="submit" value="Send"> 

      </form>
    </div>

  </div>

  <!-- Showing comments -->
  <div class="section-wrapper">

    <p class="title">Comments</p>

    {% if comments %}

      {% for comment in comments %}
        <div class="comment-item">

          <div class="header">
            <p class="score 
              {% if comment.score < '2.5' %} low
              {% elif comment.score < '3.6' %} medium 
              {% else %} good {% endif %}"><i class="fa-solid fa-star"></i> {{ comment.score }}
            </p>
            <p class="user"><i class="fa-solid fa-circle-user"></i> {{ comment.user.username }}</p>
            <p class="date"><i class="fa-solid fa-calendar-check"></i> {{ comment.date_time.date }}</p>
          </div>

          <div class="text">
            <p class="recommend 
              {% if comment.recommend == 'I Dont Recommend It' %} no
              {% elif comment.recommend == 'Not Sure To Recommend' %} not-sure 
              {% else %} yes {% endif %}"><i class="fa-solid fa-comment-dots"></i> {{ comment.recommend }}
            </p>
            <p>{{ comment.text }}</p>
          </div>
          
        </div>
      {% endfor %}

    {% else %}
        <p>There are no comments for this book.</p>
        
    {% endif %}

  </div>


  {% if user.is_authenticated %}
    <script>
      function sayAdded() {
        alert("Added to your Shopping Cart.");
      }
    </script>
  {% endif%}

{% endblock %}
